!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ethers")):"function"==typeof define&&define.amd?define(["exports","ethers"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sypher={},e.ethers)}(this,(function(e,t){"use strict";const n={validateChain:async function(e){if(!e)throw new Error("CryptoModule.validateChain: Please provide a chain to validate.");try{sypher.log("Validating chain...");const t=await fetch("https://raw.githubusercontent.com/Tukyo/sypher-tools/refs/heads/main/config/chains.min.json");if(!t.ok)throw new Error("CryptoModule.validateChain: Failed to fetch chain data.");const n=(await t.json())[e.toLowerCase()];if(!n||!n.id)throw new Error(`CryptoModule.validateChain: Chain "${e}" is not supported. Supported Chains: https://github.com/Tukyo/sypher-tools/blob/main/config/chains.json`);return`0x${n.id.toString(16)}`}catch(e){throw new Error(`CryptoModule.validateChain: ${e instanceof Error?e.message:JSON.stringify(e)}`)}}},r={initLogger:function(){const e=document.querySelector("#log-modal"),t=document.querySelector("#log-mc"),n=document.querySelector("#log-mt"),r=console.log,o=console.error;function i(e){const n=document.createElement("div");n.className="log-item";const r=sypher.cache()?.user?.environment?.timezone||"UTC",o=(new Date).toLocaleString("en-US",{timeZone:r}),i=e.filter(((e,t,n)=>!("string"==typeof e&&(e.startsWith("%c")||t>0&&"string"==typeof n[t-1]&&n[t-1].startsWith("%c")))));i.unshift(`[${o}]`),i.forEach((e=>{Array.isArray(e)?e.forEach((e=>s(e,n))):s(e,n)})),t&&(t.appendChild(n),t.scrollTop=t.scrollHeight)}function s(e,t){const n=document.createElement("div");if("string"==typeof e&&e.match(/^\[\d{1,2}\/\d{1,2}\/\d{4}, \d{1,2}:\d{2}:\d{2} (AM|PM)\]$/))n.className="log-timestamp",n.textContent=e;else if(e instanceof Error)t.classList.add("log-error"),n.className="log-object error-object",n.innerHTML=`<pre>${c(a({message:e.message,name:e.name,stack:e.stack},2))}</pre>`;else if(e instanceof HTMLElement)n.className="log-dom",n.innerHTML=`<pre>&lt;${e.tagName.toLowerCase()} id="${e.id}" class="${e.className}"&gt;</pre>`;else if("object"==typeof e&&null!==e){n.className="log-object";try{n.innerHTML=`<pre>${c(a(e,2))}</pre>`}catch(e){n.textContent=`[Unserializable object: ${e.message}]`}}else"string"==typeof e?(n.className=l(e)?"log-address":"log-string",n.textContent=e):"number"==typeof e?(n.className="log-number",n.textContent=e.toString()):(n.className="log-unknown",n.textContent=String(e));t.appendChild(n)}function a(e,t=2){const n=new WeakSet;return JSON.stringify(e,((e,t)=>{if("object"==typeof t&&null!==t){if(n.has(t))return"[Circular]";n.add(t)}return t}),t)}function c(e){return e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(\.\d+)?([eE][+-]?\d+)?)/g,(e=>{let t="log-number";return/^"/.test(e)?t=/:$/.test(e)?"log-key":l(e.replace(/"/g,""))?"log-address":"log-string":/true/.test(e)?t="log-bool-true":/false/.test(e)?t="log-bool-false":/null/.test(e)&&(t="log-null"),`<span class="${t}">${e}</span>`}))}function l(e){return/^0x[a-fA-F0-9]{40}$/.test(e)}function d(){e&&t&&n&&(t.classList.contains("lc-hide")?(t.classList.remove("lc-hide"),t.classList.add("lc-show"),n.innerHTML='<i class="fa-solid fa-caret-left"></i>',e.classList.remove("lm-hide"),e.classList.add("lm-show")):(t.classList.remove("lc-show"),t.classList.add("lc-hide"),n.innerHTML='<i class="fa-solid fa-caret-right"></i>',e.classList.remove("lm-show"),e.classList.add("lm-hide")))}console.log=function(...e){r.apply(console,e),i(e)},console.error=function(...e){o.apply(console,e),i(e)},window.onerror=function(e,t,n,r,o){i([`Error: ${e} at ${t}:${n}:${r}`,o])},window.addEventListener("unhandledrejection",(function(e){i(["Unhandled Promise Rejection:",e.reason])})),n&&n.addEventListener("click",d),d()},log:function(...e){if(!sypher.prefs().dev||!sypher.prefs().dev.logs||!sypher.prefs().dev.logs.enabled)return;const t=sypher.cache()?.user?.environment?.timezone||"UTC",n=(new Date).toLocaleString("en-US",{timeZone:t});if("string"==typeof e[0]&&e[0].startsWith("%c")){const[t,...r]=e;console.log(`%c[${n}] %c${t.slice(2)}`,"color: gray; font-weight: bold;",...r)}else console.log(`%c[${n}]`,"color: gray; font-weight: bold;",...e)}},o={truncate:function(e,t=6,n=4){if(!e)throw new Error("TruncationModule.truncate: Please provide a string to truncate.");return e.length<=t+n+3?e:`${e.slice(0,t)}...${e.slice(-n)}`},truncateBalance:function(e,t=2,n=8){if(null==e)throw new Error("TruncationModule.truncateBalance: Please provide a number to truncate.");const r=parseFloat(e.toString());if(r>=1e15)return`${(r/1e15).toFixed(t)}Q`;if(r>=1e12)return`${(r/1e12).toFixed(t)}T`;if(r>=1e9)return`${(r/1e9).toFixed(t)}B`;if(r>=1e6)return`${(r/1e6).toFixed(t)}M`;if(r>=1e3)return`${(r/1e3).toFixed(t)}K`;const o=r.toFixed(t),[i,s=""]=o.split(".");if(i.length>=n)return i;const a=n-i.length-1,c=s.slice(0,Math.max(a,0));return c?`${i}.${c}`:i}},i={pageFocus:function(){const e="visible"===document.visibilityState;return e?sypher.log("Page Focused..."):sypher.log("Page Unfocused..."),e},userEnvironment:function(){const e=navigator.userAgent||navigator.vendor,t=/Mobi|Android|iPhone|iPad|iPod|BlackBerry|Windows Phone|webOS/i.test(e),n=/iPad|Tablet/i.test(e),r=!t&&!n,o={width:window.screen.width,height:window.screen.height,availableWidth:window.screen.availWidth,availableHeight:window.screen.availHeight,colorDepth:window.screen.colorDepth,pixelDepth:window.screen.pixelDepth},i={isMobile:t,isTablet:n,isDesktop:r,deviceType:t?n?"Tablet":"Mobile":"Desktop",browser:(()=>{const t=e.toLowerCase();return/chrome|crios|crmo/i.test(t)&&!/edge|opr\//i.test(t)?"Chrome":/firefox|fxios/i.test(t)?"Firefox":/safari/i.test(t)&&!/chrome|crios|crmo|opr\//i.test(t)?"Safari":/opr\//i.test(t)?"Opera":/edg/i.test(t)?"Edge":/msie|trident/i.test(t)?"Internet Explorer":"Unknown"})(),operatingSystem:/windows phone/i.test(e)?"Windows Phone":/win/i.test(e)?"Windows":/android/i.test(e)?"Android":/mac/i.test(e)?"MacOS":/iphone|ipad|ipod/i.test(e)?"iOS":/linux/i.test(e)?"Linux":"Unknown",userAgent:e,ethereum:"ethereum"in window&&void 0!==window.ethereum,platform:navigator.platform,languages:navigator.languages||[navigator.language],cookiesEnabled:navigator.cookieEnabled,screenDetails:o,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone};return sypher.log(i),i}},s=["none","custom","default","light"],a=["none","custom","connect","provider"],c=["none","custom","log","connect"],l=/^0x[a-fA-F0-9]{40}$/,d=[],u=[{info:{icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTI4IDU2YzE1LjQ2NCAwIDI4LTEyLjUzNiAyOC0yOFM0My40NjQgMCAyOCAwIDAgMTIuNTM2IDAgMjhzMTIuNTM2IDI4IDI4IDI4WiIgZmlsbD0iIzFCNTNFNCIvPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNyAyOGMwIDExLjU5OCA5LjQwMiAyMSAyMSAyMXMyMS05LjQwMiAyMS0yMVMzOS41OTggNyAyOCA3IDcgMTYuNDAyIDcgMjhabTE3LjIzNC02Ljc2NmEzIDMgMCAwIDAtMyAzdjcuNTMzYTMgMyAwIDAgMCAzIDNoNy41MzNhMyAzIDAgMCAwIDMtM3YtNy41MzNhMyAzIDAgMCAwLTMtM2gtNy41MzNaIiBmaWxsPSIjZmZmIi8+PC9zdmc+",name:"Coinbase Wallet",rdns:"com.coinbase.wallet",uuid:"96b79a0d-c5cd-48de-924b-af5c7bb68b7e",onboard:{bool:!0,link:"https://www.coinbase.com/wallet",deeplink:"cbwallet://",fallback:{ios:"https://apps.apple.com/us/app/coinbase-wallet-nfts-crypto/id1278383455",android:"https://play.google.com/store/apps/details?id=org.toshi"}}},provider:{}},{info:{icon:"data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjMzIiB2aWV3Qm94PSIwIDAgMzUgMzMiIHdpZHRoPSIzNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iLjI1Ij48cGF0aCBkPSJtMzIuOTU4MiAxLTEzLjEzNDEgOS43MTgzIDIuNDQyNC01LjcyNzMxeiIgZmlsbD0iI2UxNzcyNiIgc3Ryb2tlPSIjZTE3NzI2Ii8+PGcgZmlsbD0iI2UyNzYyNSIgc3Ryb2tlPSIjZTI3NjI1Ij48cGF0aCBkPSJtMi42NjI5NiAxIDEzLjAxNzE0IDkuODA5LTIuMzI1NC01LjgxODAyeiIvPjxwYXRoIGQ9Im0yOC4yMjk1IDIzLjUzMzUtMy40OTQ3IDUuMzM4NiA3LjQ4MjkgMi4wNjAzIDIuMTQzNi03LjI4MjN6Ii8+PHBhdGggZD0ibTEuMjcyODEgMjMuNjUwMSAyLjEzMDU1IDcuMjgyMyA3LjQ2OTk0LTIuMDYwMy0zLjQ4MTY2LTUuMzM4NnoiLz48cGF0aCBkPSJtMTAuNDcwNiAxNC41MTQ5LTIuMDc4NiAzLjEzNTggNy40MDUuMzM2OS0uMjQ2OS03Ljk2OXoiLz48cGF0aCBkPSJtMjUuMTUwNSAxNC41MTQ5LTUuMTU3NS00LjU4NzA0LS4xNjg4IDguMDU5NzQgNy40MDQ5LS4zMzY5eiIvPjxwYXRoIGQ9Im0xMC44NzMzIDI4Ljg3MjEgNC40ODE5LTIuMTYzOS0zLjg1ODMtMy4wMDYyeiIvPjxwYXRoIGQ9Im0yMC4yNjU5IDI2LjcwODIgNC40Njg5IDIuMTYzOS0uNjEwNS01LjE3MDF6Ii8+PC9nPjxwYXRoIGQ9Im0yNC43MzQ4IDI4Ljg3MjEtNC40NjktMi4xNjM5LjM2MzggMi45MDI1LS4wMzkgMS4yMzF6IiBmaWxsPSIjZDViZmIyIiBzdHJva2U9IiNkNWJmYjIiLz48cGF0aCBkPSJtMTAuODczMiAyOC44NzIxIDQuMTU3MiAxLjk2OTYtLjAyNi0xLjIzMS4zNTA4LTIuOTAyNXoiIGZpbGw9IiNkNWJmYjIiIHN0cm9rZT0iI2Q1YmZiMiIvPjxwYXRoIGQ9Im0xNS4xMDg0IDIxLjc4NDItMy43MTU1LTEuMDg4NCAyLjYyNDMtMS4yMDUxeiIgZmlsbD0iIzIzMzQ0NyIgc3Ryb2tlPSIjMjMzNDQ3Ii8+PHBhdGggZD0ibTIwLjUxMjYgMjEuNzg0MiAxLjA5MTMtMi4yOTM1IDIuNjM3MiAxLjIwNTF6IiBmaWxsPSIjMjMzNDQ3IiBzdHJva2U9IiMyMzM0NDciLz48cGF0aCBkPSJtMTAuODczMyAyOC44NzIxLjY0OTUtNS4zMzg2LTQuMTMxMTcuMTE2N3oiIGZpbGw9IiNjYzYyMjgiIHN0cm9rZT0iI2NjNjIyOCIvPjxwYXRoIGQ9Im0yNC4wOTgyIDIzLjUzMzUuNjM2NiA1LjMzODYgMy40OTQ2LTUuMjIxOXoiIGZpbGw9IiNjYzYyMjgiIHN0cm9rZT0iI2NjNjIyOCIvPjxwYXRoIGQ9Im0yNy4yMjkxIDE3LjY1MDctNy40MDUuMzM2OS42ODg1IDMuNzk2NiAxLjA5MTMtMi4yOTM1IDIuNjM3MiAxLjIwNTF6IiBmaWxsPSIjY2M2MjI4IiBzdHJva2U9IiNjYzYyMjgiLz48cGF0aCBkPSJtMTEuMzkyOSAyMC42OTU4IDIuNjI0Mi0xLjIwNTEgMS4wOTEzIDIuMjkzNS42ODg1LTMuNzk2Ni03LjQwNDk1LS4zMzY5eiIgZmlsbD0iI2NjNjIyOCIgc3Ryb2tlPSIjY2M2MjI4Ii8+PHBhdGggZD0ibTguMzkyIDE3LjY1MDcgMy4xMDQ5IDYuMDUxMy0uMTAzOS0zLjAwNjJ6IiBmaWxsPSIjZTI3NTI1IiBzdHJva2U9IiNlMjc1MjUiLz48cGF0aCBkPSJtMjQuMjQxMiAyMC42OTU4LS4xMTY5IDMuMDA2MiAzLjEwNDktNi4wNTEzeiIgZmlsbD0iI2UyNzUyNSIgc3Ryb2tlPSIjZTI3NTI1Ii8+PHBhdGggZD0ibTE1Ljc5NyAxNy45ODc2LS42ODg2IDMuNzk2Ny44NzA0IDQuNDgzMy4xOTQ5LTUuOTA4N3oiIGZpbGw9IiNlMjc1MjUiIHN0cm9rZT0iI2UyNzUyNSIvPjxwYXRoIGQ9Im0xOS44MjQyIDE3Ljk4NzYtLjM2MzggMi4zNTg0LjE4MTkgNS45MjE2Ljg3MDQtNC40ODMzeiIgZmlsbD0iI2UyNzUyNSIgc3Ryb2tlPSIjZTI3NTI1Ii8+PHBhdGggZD0ibTIwLjUxMjcgMjEuNzg0Mi0uODcwNCA0LjQ4MzQuNjIzNi40NDA2IDMuODU4NC0zLjAwNjIuMTE2OS0zLjAwNjJ6IiBmaWxsPSIjZjU4NDFmIiBzdHJva2U9IiNmNTg0MWYiLz48cGF0aCBkPSJtMTEuMzkyOSAyMC42OTU4LjEwNCAzLjAwNjIgMy44NTgzIDMuMDA2Mi42MjM2LS40NDA2LS44NzA0LTQuNDgzNHoiIGZpbGw9IiNmNTg0MWYiIHN0cm9rZT0iI2Y1ODQxZiIvPjxwYXRoIGQ9Im0yMC41OTA2IDMwLjg0MTcuMDM5LTEuMjMxLS4zMzc4LS4yODUxaC00Ljk2MjZsLS4zMjQ4LjI4NTEuMDI2IDEuMjMxLTQuMTU3Mi0xLjk2OTYgMS40NTUxIDEuMTkyMSAyLjk0ODkgMi4wMzQ0aDUuMDUzNmwyLjk2Mi0yLjAzNDQgMS40NDItMS4xOTIxeiIgZmlsbD0iI2MwYWM5ZCIgc3Ryb2tlPSIjYzBhYzlkIi8+PHBhdGggZD0ibTIwLjI2NTkgMjYuNzA4Mi0uNjIzNi0uNDQwNmgtMy42NjM1bC0uNjIzNi40NDA2LS4zNTA4IDIuOTAyNS4zMjQ4LS4yODUxaDQuOTYyNmwuMzM3OC4yODUxeiIgZmlsbD0iIzE2MTYxNiIgc3Ryb2tlPSIjMTYxNjE2Ii8+PHBhdGggZD0ibTMzLjUxNjggMTEuMzUzMiAxLjEwNDMtNS4zNjQ0Ny0xLjY2MjktNC45ODg3My0xMi42OTIzIDkuMzk0NCA0Ljg4NDYgNC4xMjA1IDYuODk4MyAyLjAwODUgMS41Mi0xLjc3NTItLjY2MjYtLjQ3OTUgMS4wNTIzLS45NTg4LS44MDU0LS42MjIgMS4wNTIzLS44MDM0eiIgZmlsbD0iIzc2M2UxYSIgc3Ryb2tlPSIjNzYzZTFhIi8+PHBhdGggZD0ibTEgNS45ODg3MyAxLjExNzI0IDUuMzY0NDctLjcxNDUxLjUzMTMgMS4wNjUyNy44MDM0LS44MDU0NS42MjIgMS4wNTIyOC45NTg4LS42NjI1NS40Nzk1IDEuNTE5OTcgMS43NzUyIDYuODk4MzUtMi4wMDg1IDQuODg0Ni00LjEyMDUtMTIuNjkyMzMtOS4zOTQ0eiIgZmlsbD0iIzc2M2UxYSIgc3Ryb2tlPSIjNzYzZTFhIi8+PHBhdGggZD0ibTMyLjA0ODkgMTYuNTIzNC02Ljg5ODMtMi4wMDg1IDIuMDc4NiAzLjEzNTgtMy4xMDQ5IDYuMDUxMyA0LjEwNTItLjA1MTloNi4xMzE4eiIgZmlsbD0iI2Y1ODQxZiIgc3Ryb2tlPSIjZjU4NDFmIi8+PHBhdGggZD0ibTEwLjQ3MDUgMTQuNTE0OS02Ljg5ODI4IDIuMDA4NS0yLjI5OTQ0IDcuMTI2N2g2LjExODgzbDQuMTA1MTkuMDUxOS0zLjEwNDg3LTYuMDUxM3oiIGZpbGw9IiNmNTg0MWYiIHN0cm9rZT0iI2Y1ODQxZiIvPjxwYXRoIGQ9Im0xOS44MjQxIDE3Ljk4NzYuNDQxNy03LjU5MzIgMi4wMDA3LTUuNDAzNGgtOC45MTE5bDIuMDAwNiA1LjQwMzQuNDQxNyA3LjU5MzIuMTY4OSAyLjM4NDIuMDEzIDUuODk1OGgzLjY2MzVsLjAxMy01Ljg5NTh6IiBmaWxsPSIjZjU4NDFmIiBzdHJva2U9IiNmNTg0MWYiLz48L2c+PC9zdmc+",name:"MetaMask",rdns:"io.metamask",uuid:"974b295e-a371-4e37-a428-b82abf69ec3c",onboard:{bool:!0,link:"https://metamask.io/",deeplink:"metamask://",fallback:{ios:"https://apps.apple.com/us/app/metamask-blockchain-wallet/id1438144202",android:"https://play.google.com/store/apps/details?id=io.metamask&pli=1"}}},provider:{}}],h=["function latestRoundData() view returns (uint80 roundId, int256 answer, uint256 startedAt, uint256 updatedAt, uint80 answeredInRound)","function description() view returns (string)"],p=["function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function balanceOf(address account) view returns (uint256)","function decimals() view returns (uint8)","function name() view returns (string)","function symbol() view returns (string)","function totalSupply() view returns (uint256)","function transfer(address to, uint256 amount) returns (bool)"],y=["function getReserves() view returns (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast)","function token0() view returns (address)","function token1() view returns (address)","function totalSupply() view returns (uint256)","function balanceOf(address owner) view returns (uint256)","function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 value) returns (bool)","function transfer(address to, uint256 value) returns (bool)","function transferFrom(address from, address to, uint256 value) returns (bool)"],g=["function slot0() view returns (uint160 sqrtPriceX96, int24 tick, uint16 observationIndex, uint16 observationCardinality, uint16 observationCardinalityNext, uint8 feeProtocol, bool unlocked)","function token0() view returns (address)","function token1() view returns (address)","function fee() view returns (uint24)","function decimals() view returns (uint8)","function liquidity() view returns (uint128)"],m=["https://eth.llamarpc.com","https://rpc.ankr.com/eth","https://ethereum-rpc.publicnode.com","https://1rpc.io/eth","https://rpc.mevblocker.io"];const f={initTheme:function(e="default"){if("string"!=typeof e)throw new Error("InterfaceModule.initTheme: Theme must be a string.");if(this._theme)return;"none"===e&&(e="custom");const t=`sypher-${e}-theme`;if(!document.getElementById(t)){const n=document.createElement("link");n.id=t,n.rel="stylesheet",n.href=`/dist/css/themes/sypher-${e}-theme.css`,document.head.appendChild(n),this._theme=e}},applyStyle:function(e,t){if(!e||0===e.length)throw new Error("InterfaceModule.applyStyle: Elements are required.");if(!t||"object"!=typeof t)throw new Error("InterfaceModule.applyStyle: Params object is required.");const n=t.type;let r=t.theme;"none"===r&&(r="custom"),this._theme||this.initTheme(r),e.forEach((e=>{e.classList.add("sypher")}));const o=`sypher-${n}`;if(!document.getElementById(o)){const e=document.createElement("link");e.id=o,e.rel="stylesheet",e.href=`/dist/css/sypher-${n}.css`,document.head.appendChild(e)}},createButton:function(e){const t={type:"connect",text:"Connect Wallet",icon:"",modal:!1,theme:"none",append:document.body,onClick:()=>sypher.connect("ethereum"),initCrypto:{}},n={...t,...e},{type:r,text:o,icon:i,modal:c,theme:l,append:d,onClick:u,initCrypto:h}=n;if(!a.includes(r))throw new Error(`InterfaceModule.createModal: Type '${r}' not found.`);if(!s.includes(l))throw new Error(`InterfaceModule.createModal: Theme '${l}' not found.`);let p=this._theme||l;"none"===l&&(p="custom");let y=r;"none"===r&&(y="custom");const g={type:r,theme:p};if(!g)return null;if("connect"===y){if("none"===h.chain)throw new Error("InterfaceModule.createButton: Chain is required for type 'connect'.");const e=`${y}-button`,n=`${p}-button`,r=`${y}-button`;let i=document.getElementById(r);i||(i=document.createElement("button"),i.id=r,d.appendChild(i)),i.classList.add(e,n),i.textContent=o,this._connectText=o,window.addEventListener("sypher:ens",(e=>{const t=e.detail;i.textContent=t}));const s=u===t.onClick?()=>sypher.connect("none"!==h.chain?h.chain:"ethereum"):u;return c?(sypher.log("Modal Enabled..."),i.onclick=()=>this.createModal({append:document.body,type:"connect",theme:p,initCrypto:h}),sypher.initProviderSearch()):i.onclick=s,this.applyStyle([i],g),i}if("provider"===y){if("none"===h.chain)throw new Error("InterfaceModule.createButton: Chain is required for type 'provider'.");const e=document.createElement("div");e.id=o.toLowerCase().replace(/\s+/g,"-"),e.classList.add("connect-mi"),e.addEventListener("click",u);const t=document.createElement("div");t.classList.add("connect-mic");const n=document.createElement("img");n.classList.add("connect-mim"),n.src=i;const r=document.createElement("span");return r.classList.add("connect-min"),r.innerText=o,this.applyStyle([e,n,r],g),d.appendChild(e),e.appendChild(t),t.appendChild(n),e.appendChild(r),e}return null},createModal:async function(e){const t={...{append:document.body,type:"none",theme:"none",initCrypto:{}},...e},{append:n,type:r,theme:o,initCrypto:i}=t;if(!c.includes(r))throw new Error(`InterfaceModule.createModal: Type '${r}' not found.`);if(!s.includes(o))throw new Error(`InterfaceModule.createModal: Theme '${o}' not found.`);let a=this._theme||o;if("none"===o&&(a="custom"),"none"===r)return null;const l=this.initModal(r,a);if(!l)return null;if("log"===l.type)return this.applyStyle([l.parent,l.container,l.toggle],t),n.appendChild(l.parent),l.parent.appendChild(l.container),l.parent.appendChild(l.toggle),sypher.initLogger(),l;if("connect"===l.type){this.applyStyle([l.parent,l.container,l.toggle,l.head,l.title,l.body],t),l.parent.addEventListener("click",(e=>{e.target===l.parent&&l.parent.remove()})),n.appendChild(l.parent),l.parent.appendChild(l.container),l.container.appendChild(l.head),l.head.appendChild(l.title),l.head.appendChild(l.toggle),l.container.appendChild(l.body),sypher.currentProviderView(l);const e=sypher.getConnected(),r=sypher.providerSelectView(e,l,i,a);return null!=e&&sypher.accountView(e,l,r),sypher.brandingView(l),l}if("mint"===l.type)return l;throw new Error(`InterfaceModule.createModal: Type '${r}' not found.`)},initModal:function(e,t="custom"){if(!e||"string"!=typeof e)throw new Error("InterfaceModule.initModal: Type is required.");if(!c.includes(e))throw new Error(`InterfaceModule.initModal: Type '${e}' not found.`);if("none"===e||"custom"===e)return null;if("log"===e){const n=document.createElement("div");n.id=`${e}-modal`,n.classList.add(`${t}-modal`);const r=document.createElement("div");r.id=`${e}-mc`,r.classList.add(`${t}-mc`);const o=document.createElement("div");o.id=`${e}-mt`,o.classList.add(`${t}-mt`);return{type:e,parent:n,container:r,toggle:o}}if("connect"===e){const n=document.createElement("div");n.id=`${e}-modal`,n.classList.add(`${t}-modal`);const r=document.createElement("div");r.id=`${e}-mc`,r.classList.add(`${t}-mc`);const o=document.createElement("div");o.id=`${e}-mh`,o.classList.add(`${t}-mh`);const i=document.createElement("img");i.id=`${e}-mx`,i.classList.add(`${t}-mx`),i.src="https://raw.githubusercontent.com/leungwensen/svg-icon/8b84d725b0d2be8f5d87cac7f2c386682ce43563/dist/svg/zero/close-c.svg",i.addEventListener("click",(()=>{n.remove()}));const s=document.createElement("h2");s.id=`${e}-mt`,s.classList.add(`${t}-mt`),s.innerText="Connect Wallet";const a=document.createElement("div");a.id=`${e}-mb`,a.classList.add(`${t}-mb`);return{type:e,parent:n,container:r,toggle:i,head:o,title:s,body:a}}if("mint"===e){return{type:e,parent:document.body,container:document.body}}throw new Error(`InterfaceModule.initModal: Type '${e}' not found.`)},createElement:function(e){const t={...{append:document.body,type:"div",id:"",classes:[],attributes:{},events:{},innerHTML:"",children:[]},...e},{append:n,type:r,id:o,theme:i,classes:a,attributes:c,events:l,innerHTML:d,children:u}=t;if(i&&!s.includes(i))throw new Error(`InterfaceModule.createElement: Theme '${i}' not found.`);let h=this._theme||i;"none"===i&&(h="custom");const p=document.createElement(r);if(o&&""!==o&&(p.id=o),p.classList.add(`sypher-${h}-element`),p.classList.add("sypher"),a&&a.forEach((e=>{p.classList.add(e)})),c)for(const[e,t]of Object.entries(c))p.setAttribute(e,t);if(l)for(const[e,t]of Object.entries(l))p.addEventListener(e,t);return d&&""!==d&&(p.innerHTML=d),u&&u.forEach((e=>{const t=this.createElement(e);t&&(p.appendChild(t),t.classList.add("sypher"))})),n&&n.appendChild(p),p},toggleLoader:function(e){const t={...{element:document.body,isEnabled:!0,newText:"",loaderHTML:'<div class="loader"></div>',replace:!0},...e},{element:n,isEnabled:r,newText:o,loaderHTML:i,replace:s}=t;if(r){if(s)n.innerHTML=i;else if(!n.querySelector(".loader")){const e=document.createElement("div");e.classList.add("loader"),n.appendChild(e)}}else{if("sypher.revert"===o){const e=n.querySelector(".loader");return void(e&&e.remove())}n.innerHTML=o}},parallax:function(){const e=document.querySelectorAll("[data-speed]");function t(){e.forEach((e=>{const t=parseFloat(e.dataset.speed||"0.5"),n=window.scrollY*t;e.style.transform=`translateY(${-n}px)`}))}0!==e.length?(sypher.log("Parallax enabled on ",e.length," elements."),window.addEventListener("scroll",(function(){requestAnimationFrame(t)})),t()):console.warn("InterfaceModule.parallax: Parallax enabled, but no elements found with the [data-speed] attribute.")},fade:function(e="20px",t="0.5s"){if("string"!=typeof e||"string"!=typeof t)throw new Error("InterfaceModule.fade: Params must be strings.");const n=document.querySelectorAll("[data-fade]");if(0===n.length)return void console.warn("InterfaceModule.fade: Fade enabled, but no elements found with the [data-fade] attribute.");sypher.log("Fade enabled on ",n.length," elements."),n.forEach((n=>{n.style.opacity="0",n.style.transform=`translateY(${e})`,n.style.transition=`opacity ${t} ease-out, transform ${t} ease-out`}));const r=new IntersectionObserver((t=>{t.forEach((t=>{const n=t.target;t.isIntersecting&&t.intersectionRatio>.1?(n.style.opacity="1",n.style.transform="translateY(0)"):(n.style.opacity="0",n.style.transform=`translateY(${e})`)}))}),{threshold:.1});n.forEach((e=>r.observe(e)))},getUI:function(){return{theme:this._theme||"",connectText:this._connectText||""}}},w={brandingView:function(e){const t={append:{modalObj:e}.modalObj.parent,type:"div",classes:["sypher-connect-brand"],children:[{type:"p",classes:["sypher-connect-brand-text"],innerHTML:"Powered by"},{type:"div",classes:["sypher-connect-brand-logo-container"],events:{click:()=>window.open("https://sypher.tools","_blank")},children:[{type:"div",classes:["sypher-connect-brand-logo"],innerHTML:'\n                            <svg id="sypher-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 105.87 120.22">\n                                <g id="Layer_2" data-name="Layer 2">\n                                    <g id="svg1">\n                                        <g id="layer1">\n                                            <g id="g28">\n                                                <path id="path18-6-3" class="cls-1"\n                                                    d="M15.16,0h7V16.56H42.35V0h7V16.56h52.22l2.3,2.54q-5,20.15-15.54,34.48a83.94,83.94,0,0,1-18,17.81h30l4.19,3.72A117.92,117.92,0,0,1,86.24,95.7l-5.07-4.62a100.71,100.71,0,0,0,13-13.1H80.54l-.07,7.41q0,12.7-4.19,20.5a43,43,0,0,1-12.32,14l-5.2-5.23a33,33,0,0,0,11.59-12q3.77-7,3.76-17.24L74,78H55.62V71.39A77.14,77.14,0,0,0,81.19,51.5a70.26,70.26,0,0,0,14.18-28H80.46C80,25.78,77.65,35.39,66.37,49.46A193.42,193.42,0,0,1,47.31,68.51v41.68h-7V74.26Q26,85,15.17,89.2l-3.93-6.43Q36.8,73.55,61,44.84s11.5-14.36,11.39-21.32H64.51v0H49.35v12.7a28.57,28.57,0,0,1-5.9,17A36,36,0,0,1,26.89,65.61l-4.43-6.88Q31.84,56.35,37.1,50a21.06,21.06,0,0,0,5.25-13.57V23.56H22.16V40.27h-7V23.56H0v-7H15.16ZM76.61,113.11l29,.12.27,7-29-.12Z" />\n                                            </g>\n                                        </g>\n                                    </g>\n                                </g>\n                            </svg>'}]}]};if(!sypher.createElement(t))return null},accountView:function(e,t,n){t.title.innerHTML="Account",t.body.style.padding="0px";const r=sypher.getCleaned(),o=sypher.getChain(),{user:{ens:i,ethBalance:s=0,tokenBalance:a=0,value:c=""}={},token:{address:l="",icon:d="",symbol:u="",price:h=0,decimals:p=0}={}}=r||{},{name:y="",icon:g=[{url:""}],nativeCurrency:{symbol:m="",decimals:f=0}={},explorers:w=[{name:"",url:"",icon:""}]}=o||{},M=function(e){return{append:e.modalObj.body,type:"div",id:"account-view",children:[{type:"div",classes:["av-h"],children:[{type:"h2",classes:["av-h-ti"],innerHTML:e.user.ens?`${sypher.truncate(e.user.ens)}`:`${sypher.truncate(e.user.account)}`,attributes:{"s-data":`${e.user.account}`}},{type:"div",classes:["av-h-ch-c"],children:[{type:"img",classes:["av-h-ch-i"],attributes:{src:`https://ipfs.io/ipfs/${e.chain.icon[0].url.replace("ipfs://","")}`}},{type:"img",classes:["av-h-ch-ar"],attributes:{src:"https://raw.githubusercontent.com/leungwensen/svg-icon/8b84d725b0d2be8f5d87cac7f2c386682ce43563/dist/svg/zero/arrow-down-l.svg"}}]},{type:"h2",classes:["av-h-ba"],innerHTML:`${sypher.truncateBalance(parseFloat(e.user.ethBalance.toString()))} ${e.chain.nativeCurrency.symbol}`,attributes:{"s-data":`${e.user.ethBalance}`}}]},{type:"div",classes:["av-b"],children:[{type:"div",id:"av-b-td",classes:[e.token.tokenDetailClass],children:[{type:"div",classes:["av-b-td-ic"],children:[{type:"img",classes:["av-b-td-i"],attributes:{src:e.token.icon}},{type:"div",classes:["av-b-td-n"],innerHTML:e.token.showTokenDetails?`$${sypher.truncateBalance(parseFloat(e.token.tokenPrice.toString()),e.token.tokenDecimals)}`:""}],attributes:{"s-data":`${e.token.address}`}},{type:"div",classes:["av-b-td-bc"],children:[{type:"div",classes:["av-b-td-bal"],innerHTML:e.token.showTokenDetails?`${sypher.truncateBalance(parseFloat(e.token.userBalance.toString()))} ${e.token.tokenSymbol}`:"",attributes:{"s-data":`${e.token.userBalance}`}},{type:"div",classes:["av-b-td-val"],innerHTML:e.token.showTokenDetails?`$${sypher.truncateBalance(parseFloat(e.token.userValue.toString()))}`:"",attributes:{"s-data":`${sypher.truncateBalance(parseFloat(e.token.userValue.toString()))}`}}]}]},{type:"div",id:"av-b-provider",classes:["av-b-b"],events:{click:()=>{const t=document.getElementById("account-view");t&&(t.style.display="none");let n="";const r=sypher.getProviderDetail();r&&(n=r.info.name.replace(/\s+/g,"").toLowerCase());const o=document.querySelectorAll(".connect-mi");o.forEach((e=>{const t=e;t.id.replace(/[\s-]+/g,"").toLowerCase()===n?t.style.display="none":t.style.display="flex"}));const i=document.getElementById("connect-mb");if(i&&(i.style.padding="15px"),e.modalObj.title.innerHTML="Change Wallet",r){const n=document.getElementById("current-provider-container");if(n){const s=document.getElementById("current-provider-name"),a=document.getElementById("current-provider-icon");s&&(s.innerHTML=r.info.name),a&&a.setAttribute("src",r.info.icon),n.style.display="flex",n.onclick=()=>{t&&(t.style.display="flex"),o.forEach((e=>{e.style.display="none"})),i&&(i.style.padding="0px"),e.modalObj.title.innerHTML="Account",n.style.display="none"}}}}},children:[{type:"div",classes:["av-b-bn-ic"],children:[{type:"img",classes:["av-b-bn-i"],attributes:{src:e.mergedProviders[0].info.icon}},{type:"img",classes:["av-b-bn-i"],attributes:{src:e.mergedProviders[1].info.icon}}]},{type:"div",classes:["av-b-bn-t"],innerHTML:"Change Wallet"}]}]},{type:"div",classes:["av-x"],events:{click:()=>{sypher.disconnect();const t=document.getElementById("account-view");t&&t.parentNode&&t.parentNode.removeChild(t),document.querySelectorAll(".connect-mi").forEach((e=>{e.style.display="flex"}));const n=document.getElementById("connect-button");n&&sypher._connectText&&(n.innerHTML=sypher._connectText),e.modalObj.title.innerHTML="Connect Wallet"}},innerHTML:"Disconnect"}]}}({sypher:sypher,modalObj:t,mergedProviders:n,user:{ens:i,account:e,ethBalance:s},token:{tokenDetailClass:r?"av-b-c":"av-b-c-hide",showTokenDetails:!!r,address:l,icon:d,tokenPrice:h,tokenDecimals:p,userBalance:a,tokenSymbol:u,userValue:c},chain:{name:y,icon:g,nativeCurrency:{symbol:m,decimals:f},explorers:w}});if(!sypher.createElement(M))return null},currentProviderView:function(e){const t=document.createElement("div");t.id="current-provider-container";const n=document.createElement("div");n.id="current-provider-info-container";const r=document.createElement("div");r.id="current-provider-icon-container";const o=document.createElement("img");o.id="current-provider-icon";const i=document.createElement("span");i.id="current-provider-name";const s=document.createElement("div");s.id="sypher-back";const a=document.createElement("img");a.id="sypher-back-icon",a.src="https://raw.githubusercontent.com/leungwensen/svg-icon/8b84d725b0d2be8f5d87cac7f2c386682ce43563/dist/svg/zero/arrow-left-l.svg",e.body.appendChild(t),t.appendChild(s),s.appendChild(a),t.appendChild(n),n.appendChild(i),n.appendChild(r),r.appendChild(o),t.style.display="none"},providerSelectView:function(e,t,n,r){const o=[...u.map((e=>{const t=d.find((t=>t.info.name===e.info.name)),n=t||e;return t&&(n.info.onboard||(n.info.onboard={bool:!1,link:"",deeplink:"",fallback:{ios:"",android:""}}),n.info.onboard.bool=!1),n})),...d.filter((e=>!u.some((t=>t.info.name===e.info.name))))];return sypher.log("[EIP-6963] Providers:",o),o.forEach((o=>{const{name:i,icon:s}=o.info,a=o.info.onboard?.bool?()=>{sypher.onboard(o)}:()=>{"none"!==n.chain?sypher.initCrypto({chain:n.chain,contractAddress:n.contractAddress,poolAddress:n.poolAddress,pairAddress:n.pairAddress,version:n.version,detail:o,icon:n.icon}):sypher.connect(n.chain,o)},c=sypher.createButton({append:t.body,type:"provider",text:i,icon:s,modal:!1,theme:r,onClick:a,initCrypto:n});null!==c&&null!=e&&(c.style.display="none")})),o}},M={initCrypto:async function(e){if(!e)return null;e.pair||(e.pair="ethereum"),this.flush(),this._isLoading=!0;const t=document.getElementById("connect-button")||null;t&&(sypher.toggleLoader({element:t}),t.disabled=!0);try{if(!(this._chain?.chainId??await sypher.validateChain(e.chain)))return null;const n=await this.connect(e.chain,e.detail);if(!n)return null;const r=n.primaryAccount;if(!r)return null;const o=n.ethBalance;if(null==o)return null;sypher.log("Getting details for:",e);const i=await this.getTokenDetails(e.chain,e.contractAddress);if(!i)return null;const{balance:s,decimals:a,name:c,symbol:l,totalSupply:d}=i;let u,h,p;if("V2"===e.version){const t=await this.getPriceV2(e.chain,e.poolAddress,e.pair,e.pairAddress);if(!t)return null;u=t.price,h=t.details}else{if("V3"!==e.version)return null;{const t=await this.getPriceV3(e.chain,e.contractAddress,e.poolAddress,e.pair,e.pairAddress);if(!t)return null;u=t.price,p=t.details}}const y=this.getUserValue(s,u);if(null==y)return null;const g=e.contractAddress,m=e.poolAddress,f=e.pairAddress,w=e.icon??"",M=e.version,I=e.pair,v=this._ens??void 0,b={address:r,ens:v,contractAddress:g,poolAddress:m,pairAddress:f,balance:s,ethBalance:o,decimals:a,name:c,symbol:l,icon:w,totalSupply:d,tokenPrice:u,userValue:y,version:M,pair:I,v2Detail:h,v3Detail:p};if(!b)return null;const E=this.clean(b);if(!E)return null;const N=E;window.dispatchEvent(new CustomEvent("sypher:initCrypto",{detail:N})),sypher.log("%c🔵 Init Success! 🔵","color: #0972C6;");const C=v?sypher.truncate(v):sypher.truncate(r);return t&&C&&sypher.toggleLoader({element:t,isEnabled:!1,newText:C}),N}catch(e){throw new Error(`CryptoModule.initCrypto: ${e instanceof Error?e.message:JSON.stringify(e)}`)}finally{let e;this._isLoading=!1,e=this._ens?sypher.truncate(this._ens)??sypher.getUI().connectText:this._connected?sypher.truncate(this._connected)??sypher.getUI().connectText:sypher.getUI().connectText,t&&(sypher.toggleLoader({element:t,isEnabled:!1,newText:e}),t.disabled=!1)}},connect:async function(e,t=null){if(!e)throw new Error("CryptoModule.connect: Chain is required");sypher.log("Chain:",e),sypher.log("Chosen Provider:",t);const n=document.getElementById("connect-button")||null;n&&(sypher.toggleLoader({element:n}),n.disabled=!0);const r=t||this._EIP6963;if(this._connected&&!r)return{primaryAccount:this._connected,ethBalance:this._ethBalance};if(r){const t=document.querySelectorAll(".connect-mi"),o=document.getElementById("connect-mb"),i=document.getElementById("connect-mc"),s=document.getElementById("connect-modal");if(t.length>0&&t.forEach((e=>{e.style.display="none"})),o){const e={element:o,loaderHTML:"<div class='loader'></div>",isEnabled:!0,replace:!1};sypher.toggleLoader(e)}this._EIP6963=r;try{const t=r.provider;sypher.log("[EIP-6963]",r.info.name);const n=await t.request({method:"eth_requestAccounts"});if(!Array.isArray(n)||!n.length)throw new Error("No accounts returned by the chosen provider.");const a=n[0];await this.switchChain(e),this._connected=a,o&&(o.innerHTML=`\n                        <div class="connect-sb">\n                            <p class="connect-s">Connected to ${r.info.name}</p>\n                            <p class="connect-s">Account: <span class="sypher-a">${sypher.truncate(a)}</span></p>\n                        </div>\n                    `,o.classList.add("min-height-a")),i&&i.classList.add("height-a"),s&&(setTimeout((()=>{s.style.opacity="0%"}),5e3),setTimeout((()=>{s.remove()}),6e3)),sypher.log("%c[EIP-6963] ✔️ Connection Success! ✔️","color: #00a82a; font-weight: bold;"),sypher.log(a),window.dispatchEvent(new CustomEvent("sypher:connect",{detail:a})),this.accountChange(!0);const c=await this.getETH();return this._ethBalance=c,this.getENS(a),{primaryAccount:a,ethBalance:c}}catch(e){const n=e instanceof Error?`${e.message}\n${e.stack}`:JSON.stringify(e,Object.getOwnPropertyNames(e));if(4001===e.code){if(sypher.log("%c❌ User Denied Wallet Access ❌","color: #ff0000; font-weight: bold;"),window.dispatchEvent(new CustomEvent("sypher:connectFail",{detail:"User denied wallet access"})),this.disconnect(),o){const e={element:o,isEnabled:!1,newText:"sypher.revert"};sypher.toggleLoader(e)}return t.forEach((e=>{e.style.display="flex"})),null}throw new Error(`CryptoModule.connect: ${n}`)}finally{if(!this._isLoading){let e;e=this._ens?sypher.truncate(this._ens)??sypher.getUI().connectText:this._connected?sypher.truncate(this._connected)??sypher.getUI().connectText:sypher.getUI().connectText,n&&(sypher.toggleLoader({element:n,isEnabled:!1,newText:e}),n.disabled=!1)}}}else try{const t=this.getProvider();if(!t)return null;const n=await t.request({method:"eth_requestAccounts"});if(!Array.isArray(n)||0===n.length)throw new Error("CryptoModule.connect: No accounts returned by the Ethereum provider.");const r=n[0];if(!r)return console.warn("CryptoModule.connect: Wallet not connected."),null;await this.switchChain(e),this._connected=r,sypher.log("%c[WINDOW] ✔️ Connection Success! ✔️","color: #00a82a; font-weight: bold;"),sypher.log(r),window.dispatchEvent(new CustomEvent("sypher:connect",{detail:r})),this.accountChange(!0);const o=await this.getETH();return this._ethBalance=o,this.getENS(r),{primaryAccount:r,ethBalance:o}}catch(e){const t=e instanceof Error?`${e.message}\n${e.stack}`:JSON.stringify(e,Object.getOwnPropertyNames(e));throw new Error(`CryptoModule.connect: ${t}`)}finally{if(!this._isLoading){let e;e=this._ens?sypher.truncate(this._ens)??sypher.getUI().connectText:this._connected?sypher.truncate(this._connected)??sypher.getUI().connectText:sypher.getUI().connectText,n&&(sypher.toggleLoader({element:n,isEnabled:!1,newText:e}),n.disabled=!1)}}},disconnect:async function(){window.dispatchEvent(new CustomEvent("sypher:disconnect",{detail:this._connected})),this.accountChange(!1),this.flush()},accountChange:function(e){let t=this._EIP6963?.provider;if(t||(t=this.getProvider()),null!==this._connected&&void 0!==this._connected)if(e)sypher.log("Listening for account changes..."),t.on("accountsChanged",(e=>{if(!e.length)return void this.disconnect();this._connected=e[0],window.dispatchEvent(new CustomEvent("sypher:accountChange",{detail:this.getConnected()}));const t=document.getElementById("connect-modal");t&&t.remove(),this._chain&&(this._details?this._EIP6963?this.initCrypto({chain:this._chain.shortName.toLowerCase(),contractAddress:this._details.token.address,poolAddress:this._details.token.poolAddress,pairAddress:this._details.token.pairAddress,version:this._details.token.version,pair:this._details.token.pair,icon:this._details.token.icon,detail:this._EIP6963}):console.log("Unknown Error Occured..."):this.connect(this._chain.chainId,this._EIP6963))}));else{t.removeAllListeners("accountsChanged");const e=document.getElementById("connect-modal");e&&e.remove()}},onboard:async function(e){const t=sypher.userEnvironment(),n=t.isMobile,r="macos"===t.operatingSystem.toLowerCase(),o="android"===t.operatingSystem.toLowerCase();if(n){if(n){const{deeplink:t,fallback:n}=e.info.onboard;if(!r&&!o)return;{const e=r?"ios":"android",o=setTimeout((()=>{if(sypher.log("Deeplink failed, prompting user for App Store redirection..."),"ios"===e){confirm("Unable to open the app. Please click confirm to download from the app store.")?window.location.href=n[e]:sypher.log("User canceled App Store redirection.")}else{const t=document.createElement("a");t.href=n[e],t.target="_self",t.rel="noopener",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}),1e3);window.location.href=t,window.addEventListener("blur",(()=>clearTimeout(o)),{once:!0})}}}else window.open(e.info.onboard.link,"_blank")},getETH:async function(){let e=this._EIP6963?.provider;e||(e=this.getProvider());const n=new t.ethers.providers.Web3Provider(e).getSigner(),r=await n.getBalance(),o=parseFloat(t.ethers.utils.formatEther(r));return sypher.log("ETH Balance:",o),o},getENS:async function(e){if(!e)throw new Error("CryptoModule.getENS: Address is required");if(this._ens)return this._ens;try{const t=await this.getProvider(!0);if(!Array.isArray(t))throw new Error("CryptoModule.getENS: Expected an array of providers but got something else.");const n=t.slice().sort((()=>Math.random()-.5));for(const t of n)try{const n=await t.lookupAddress(e);if(n)return sypher.log("[ENS Found]:",n),this._ens=n,this._isLoading||window.dispatchEvent(new CustomEvent("sypher:ens",{detail:n})),n}catch(e){console.warn(`[ENS Lookup Failed]: ${e instanceof Error?e.message:String(e)}`)}return void console.warn("CryptoModule.getENS: All providers failed ENS lookup.")}catch(e){throw new Error(`CryptoModule.getENS: ${e instanceof Error?e.message:JSON.stringify(e)}`)}},getChain:function(){return this._chain},switchChain:async function(e){if(!e)throw new Error("CryptoModule.switchChain: Chain is required");let t=this._EIP6963?.provider;t||(t=this.getProvider());const n=await this.getChainData(e);if(!n)return;const r=n.chainId;if(this._chain?.chainId!==r){n&&(this._chain=n);try{if(await t.request({method:"eth_chainId"})===r)return void(this._chain&&(this._chain.chainId=r));sypher.log(`Switching to ${e} chain...`),await t.request({method:"wallet_switchEthereumChain",params:[{chainId:r}]}),this._chain&&(this._chain.chainId=r)}catch(o){if(console.warn(`CryptoModule.switchChain: Attempting to add chain: ${e}`),4902!==o.code)throw new Error(`CryptoModule.switchChain: Unable to switch chain "${e}". Details: ${o}`);try{await t.request({method:"wallet_addEthereumChain",params:[n]}),this._chain&&(this._chain.chainId=r)}catch(t){throw new Error(`CryptoModule.switchChain: Unable to add chain "${e}". Details: ${t}`)}}}},getChainData:async function(e){if(!e)throw new Error("CryptoModule.getChainData: Chain is required");try{const t=this._chain?.chainId??await sypher.validateChain(e);if(!t)return null;const n=`https://raw.githubusercontent.com/ethereum-lists/chains/refs/heads/master/_data/chains/eip155-${parseInt(t,16)}.json`,r=await fetch(n);if(!r.ok)throw new Error(`Chain data for ID ${t} not found`);const o=await r.json();let i;if(sypher.log("Fetched chain data:",o),o.icon)try{const e=`https://raw.githubusercontent.com/ethereum-lists/chains/refs/heads/master/_data/icons/${o.icon}.json`,t=await fetch(e);t.ok?i=await t.json():console.warn(`Icon data for ${o.icon} not found`)}catch(e){console.warn(`Error fetching icon data for ${o.icon}:`,e)}return{name:o.name,chain:o.chain,icon:i,rpc:o.rpc,nativeCurrency:o.nativeCurrency,infoURL:o.infoURL,shortName:o.shortName,chainId:`0x${parseInt(o.chainId,10).toString(16)}`,networkId:o.networkId,ens:o.ens||void 0,explorers:o.explorers||void 0}}catch(e){throw new Error(`CryptoModule.getChainData: ${e instanceof Error?e.message:JSON.stringify(e)}`)}},getPriceFeed:async function(e="ethereum"){if(this._pairPrice&&this._pairPrice.value&&this._pairPrice.timestamp&&Date.now()-this._pairPrice.timestamp<6e4)return this._pairPrice.value;"wrappedbitcoin"===e.toLowerCase().replace(/\s+/g,"")&&(e="bitcoin");try{const n=await fetch("https://raw.githubusercontent.com/Tukyo/sypher-tools/refs/heads/main/config/chainlink.min.json");if(!n.ok)throw new Error("CryptoModule.getPriceFeed: Unable to fetch Chainlink data");const r=(await n.json())[e.toLowerCase().replace(/\s+/g,"")];if(!r)throw new Error(`CryptoModule.getPriceFeed: No data found for ${e}. Reference: https://github.com/Tukyo/sypher-tools/blob/main/config/chainlink.json`);const o=Object.keys(r);sypher.log(`Available quotes for ${e}:`,o);let i=r.usd||r.eth;if(!i)throw new Error(`CryptoModule.getPriceFeed: No USD, ETH, or BTC quote found for ${e}`);sypher.log("Chosen Quote Details:",i);const{proxy:s,decimals:a}=i,c=await this.getProvider(!0);if(!Array.isArray(c))throw new Error("CryptoModule.getPriceFeed: Expected an array of providers but got something else.");const l=c.slice().sort((()=>Math.random()-.5));for(const n of l)try{const o=new t.ethers.Contract(s,h,n),i=await o.latestRoundData(),c=await o.description(),l=t.ethers.utils.formatUnits(i.answer,a);if(sypher.log(`${c}: ${l}`),r.usd)return this._pairPrice={value:l,timestamp:Date.now()},l;{const r="0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419",o=new t.ethers.Contract(r,h,n),i=await o.latestRoundData(),s=t.ethers.utils.formatUnits(i.answer,8),a=(parseFloat(l)*parseFloat(s)).toFixed(8);return sypher.log(`Final Price for ${e}: $${a}`),this._pairPrice={value:a.toString(),timestamp:Date.now()},a.toString()}}catch(e){console.warn(`[Price Fetch Failed]: ${e instanceof Error?e.message:String(e)}`)}}catch(e){throw new Error(`CryptoModule.getPriceFeed: ${e instanceof Error?e.message:JSON.stringify(e)}`)}},getTokenDetails:async function(e,n){if(!e)throw new Error("CryptoModule.getTokenDetails: Chain is required");if(!n)throw new Error("CryptoModule.getTokenDetails: Contract address is required");if(!n.match(l))throw new Error("CryptoModule.getTokenDetails: Invalid contract address");try{let r=this._connected;if(null==r){const t=await this.connect(e);if(!t)return null;r=t.primaryAccount}if(!r)return null;let o=this._EIP6963?.provider;o||(o=this.getProvider());const i=new t.ethers.providers.Web3Provider(o).getSigner(),s=new t.ethers.Contract(n,p,i),a=await s.balanceOf(r),c=await s.decimals(),l=await s.name(),d=await s.symbol(),u=await s.totalSupply();return sypher.log("Raw Details:",{balance:a,decimals:c,name:l,symbol:d,totalSupply:u}),{balance:a,decimals:c,name:l,symbol:d,totalSupply:u}}catch(e){throw new Error(`CryptoModule.getTokenDetails: ${e instanceof Error?e.message:JSON.stringify(e)}`)}},getPriceV2:async function(e,n,r,o){if(!e)throw new Error("CryptoModule.getPriceV2: Chain is required");if(!n)throw new Error("CryptoModule.getPriceV2: Pool address is required");if(!n.match(l))throw new Error("CryptoModule.getPriceV2: Invalid pool address");if(!r)throw new Error("CryptoModule.getPriceV2: Pair is required");if(!o)throw new Error("CryptoModule.getPriceV2: Pair address is required");if(!o.match(l))throw new Error("CryptoModule.getPriceV2: Invalid pair address");try{if(!(this._chain?.chainId??await sypher.validateChain(e)))return null;let i=this._connected;if(null==i){const t=await this.connect(e);if(!t)return null;i=t.primaryAccount}if(!i)return null;const s=await this.getPriceFeed(r);if(!s)return null;let a=this._EIP6963?.provider;a||(a=this.getProvider());const c=new t.ethers.providers.Web3Provider(a).getSigner(),l=new t.ethers.Contract(n,y,c),d=await l.token0(),u=await l.token1(),h=await l.getReserves(),g=h._reserve0,m=h._reserve1,f=new t.ethers.Contract(d,p,c),w=new t.ethers.Contract(u,p,c),M=await f.decimals(),I=await w.decimals();if(sypher.log("Reserve 0:",g),sypher.log("Reserve 1:",m),sypher.log("Token 0:",d),sypher.log("Token 1:",u),sypher.log("Decimals 0:",M),sypher.log("Decimals 1:",I),!(M&&I&&g&&m&&d&&u))return null;const v=t.ethers.BigNumber.from(g),b=t.ethers.BigNumber.from(m),E=parseFloat(t.ethers.utils.formatUnits(v,M)),N=parseFloat(t.ethers.utils.formatUnits(b,I));let C;if(u.toLowerCase()===o.toLowerCase())C=N/E;else{if(d.toLowerCase()!==o.toLowerCase())throw new Error(`CryptoModule.getPriceV2: Neither token is ${r}`);C=E/N}const L=C*parseFloat(s);sypher.log(`V2 Price for token in pool ${n}: $${L}`);return{price:L,details:{token0:d,token1:u,decimals0:M,decimals1:I,reserve0:v,reserve1:b}}}catch(e){throw new Error(`CryptoModule.getPriceV2: ${e instanceof Error?e.message:JSON.stringify(e)}`)}},getPriceV3:async function(e,n,r,o,i){if(!e)throw new Error("CryptoModule.getPriceV3: Chain is required");if(!n)throw new Error("CryptoModule.getPriceV3: Contract address is required");if(!n.match(l))throw new Error("CryptoModule.getPriceV3: Invalid contract address");if(!r)throw new Error("CryptoModule.getPriceV3: Pool address is required");if(!r.match(l))throw new Error("CryptoModule.getPriceV3: Invalid pool address");if(!o)throw new Error("CryptoModule.getPriceV3: Pair is required");if(!i)throw new Error("CryptoModule.getPriceV3: Pair address is required");if(!i.match(l))throw new Error("CryptoModule.getPriceV3: Invalid pair address");try{if(!(this._chain?.chainId??await sypher.validateChain(e)))return null;let s=this._connected;if(null==s){const t=await this.connect(e);if(!t)return null;s=t.primaryAccount}if(!s)return null;const a=await this.getPoolV3(e,n,r);if(!a)return null;const{sqrtPriceX96:c,token0:l,token1:d,decimals0:u,decimals1:h}=a,p=t.ethers.BigNumber.from(c),y=t.ethers.BigNumber.from("79228162514264337593543950336"),g=p.mul(p).mul(t.ethers.BigNumber.from(10).pow(u)),m=y.mul(y).mul(t.ethers.BigNumber.from(10).pow(h)),f=g.div(m),w=g.mod(m),M=8,I=t.ethers.BigNumber.from(10).pow(M),v=w.mul(I).div(m),b=parseFloat(f.toString())+parseFloat(v.toString())/Math.pow(10,M);let E;if(d.toLowerCase()===i.toLowerCase())E=b;else{if(l.toLowerCase()!==i.toLowerCase())throw new Error(`CryptoModule.getPriceV3: Neither token is ${o}`);E=1/b}const N=await this.getPriceFeed(o);if(!N)return null;const C=E*parseFloat(N);return sypher.log(`V3 Price for token in pool ${sypher.truncate(r)}: $${C}`),{price:C,details:a}}catch(e){throw new Error(`CryptoModule.getPriceV3: ${e instanceof Error?e.message:JSON.stringify(e)}`)}},getPoolV3:async function(e,n,r){if(!e)throw new Error("CryptoModule.getPoolV3: Chain is required");if(!n)throw new Error("CryptoModule.getPoolV3: Contract address is required");if(!n.match(l))throw new Error("CryptoModule.getPoolV3: Invalid contract address");if(!r)throw new Error("CryptoModule.getPoolV3: Pool address is required");if(!r.match(l))throw new Error("CryptoModule.getPoolV3: Invalid pool address");try{if(!(this._chain?.chainId??await sypher.validateChain(e)))return null;let n=this._connected;if(null==n){const t=await this.connect(e);if(!t)return null;n=t.primaryAccount}if(!n)return null;let o=this._EIP6963?.provider;o||(o=this.getProvider());const i=new t.ethers.providers.Web3Provider(o).getSigner(),s=new t.ethers.Contract(r,g,i),a=(await s.slot0()).sqrtPriceX96;sypher.log("Sqrt Price X96:",a);const c=await s.token0(),l=await s.token1();sypher.log("Token 0:",c),sypher.log("Token 1:",l);const d=new t.ethers.Contract(c,p,i),u=new t.ethers.Contract(l,p,i),h=await d.decimals(),y=await u.decimals();sypher.log("Decimals 0:",h),sypher.log("Decimals 1:",y);const m=await s.liquidity();sypher.log("Liquidity:",m);return{sqrtPriceX96:a,token0:c,token1:l,decimals0:h,decimals1:y,liquidity:m}}catch(e){throw new Error(`CryptoModule.getPoolV3: ${e instanceof Error?e.message:JSON.stringify(e)}`)}},getUserValue:function(e,t){if(!e)throw new Error("CryptoModule.getUserValue: Balance is required");if(!t)throw new Error("CryptoModule.getUserValue: Price is required");if("object"!=typeof e)throw new Error("CryptoModule.getUserValue: Invalid balance");if("number"!=typeof t)throw new Error("CryptoModule.getUserValue: Invalid price");try{const n=parseFloat(e.toString())*parseFloat(t.toString());return sypher.log(`User Value: ${n}`),n}catch(e){throw new Error(`CryptoModule.getUserValue: ${e instanceof Error?e.message:JSON.stringify(e)}`)}},clean:function(e){if(!e)throw new Error("CryptoModule.clean: Token details are required");const n={user:{address:e.address,ens:e.ens,ethBalance:e.ethBalance,tokenBalance:parseFloat(t.ethers.utils.formatUnits(e.balance,e.decimals)),value:(parseFloat(e.userValue.toString())/Math.pow(10,e.decimals)).toFixed(e.decimals).toString()},token:{address:e.contractAddress,poolAddress:e.poolAddress,pairAddress:e.pairAddress,decimals:e.decimals,name:e.name,symbol:e.symbol,icon:e.icon,totalSupply:parseFloat(t.ethers.utils.formatUnits(e.totalSupply,e.decimals)),price:parseFloat(e.tokenPrice.toString()),version:e.version,pair:e.pair,v2Detail:e.v2Detail,v3Detail:e.v3Detail}};for(const e in n.user)void 0===n.user[e]&&delete n.user[e];for(const e in n.token)void 0===n.token[e]&&delete n.token[e];return this._details=n,sypher.log("Cleaned Details:",n),n},getCleaned:function(){return this._details??null},initProviderSearch:function(){window.addEventListener("eip6963:announceProvider",(e=>{const t=e;d.push(t.detail),sypher.log("[EIP-6963] Provider Announced:",t.detail.info.name)})),window.dispatchEvent(new Event("eip6963:requestProvider"))},initPublicProviders:async function(){for(const e of m)try{const n=new t.ethers.providers.JsonRpcProvider(e);await n.getBlockNumber(),sypher.log(`[Public RPC]: ${e}`),this._publicProviders||(this._publicProviders=[]),this._publicProviders.push(n)}catch(t){console.warn(`[Public RPC Failed]: ${e} - ${t instanceof Error?t.message:String(t)}`)}},getProvider:async function(e=!1){if(e){this._publicProviders||await this.initPublicProviders();return this._publicProviders}if(this._EIP6963)return sypher.log("[EIP6963] Stored Provider: ",this._EIP6963.provider),this._EIP6963.provider;if("undefined"==typeof window||!window.ethereum)throw new Error("CryptoModule.getProvider: No Ethereum provider found.");return sypher.log("[WINDOW]:",window.ethereum),window.ethereum},getProviderDetail:function(){if(this._EIP6963)return this._EIP6963;throw new Error("CryptoModule.getProviderDetail: No provider details found.")},getConnected(){return this._connected??null},flush:function(){if(null===this._connected||void 0===this._connected)return void sypher.log("Nothing to flush...");this._connected=void 0,this._details=void 0,this._pairPrice=void 0,this._ethBalance=void 0,this._ens=void 0,this._isLoading=!1;let e=this._EIP6963?.provider;e||(e=this.getProvider()),e.removeAllListeners("accountsChanged");const t=document.getElementById("connect-button"),n=sypher.getUI().connectText;t&&(t.innerHTML=n);const r=document.getElementById("current-provider-container");r&&(r.style.display="none")}},I={_prefs:{interface:{theme:"custom",button:{}},crypto:{},dev:{logs:{enabled:!1,modal:!1}}},_cache:{user:{environment:{}}},init:function(e){if(this._prefs=e,e.dev?.logs?.modal&&(e.dev.logs.enabled?sypher.createModal({append:document.body,type:"log",theme:e.interface.theme}):console.warn("Cannot create a log modal when logs are disabled.")),"none"===e.interface.theme&&(e.interface.theme="custom"),sypher.initTheme(e.interface.theme),e.crypto&&sypher.initPublicProviders(),e.interface.button){const t={...e.interface.button,...e.crypto&&{initCrypto:e.crypto}};sypher.createButton(t)}this._cache={user:{environment:sypher.userEnvironment()}}},prefs:function(){const e=this._prefs;if(!e)throw new Error("User preferences have not been initialized.");return e},cache:function(){const e=this._cache;if(!e)throw new Error("User cache has not been initialized.");return e}},v="1.0.0",b="https://sypher.tools",E="https://github.com/Tukyo/sypher-tools";!function(e){const t={...I,...M,...n,...r,...f,...w,...o,...i};e.sypher=t;const s=console.info.bind(console),a=["color: #fff","background: linear-gradient(45deg, #ff0066, #6600ff)","font-size: 12px","font-weight: bold","padding: 5px 10px","border-radius: 5px","text-shadow: 1px 1px 3px rgba(0,0,0,0.3)"].join(";");setTimeout((function(){console.groupCollapsed("%cSypher Initialized",a),s(`🔗 Website: ${b}`),s(`📖 Repo: ${E}`),s(`⚙️ Version: ${v}`),console.groupEnd()}),0)}(window),e.repo=E,e.version=v,e.website=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sypher.umd.min.js.map
